source,app,title,description,datamodel,"providing_technologies","security_domain",category,"use_case",mitre,killchain,"detection_searches","investigative_searches","contextual_searches","support_searches",qualifiedSearch
ES,"DA-ESS-EndpointProtection","Abnormally High Number of Endpoint Changes By User","Detects an abnormally high number of endpoint changes by user account, as they relate to restarts, audits, filesystem, user, and registry modifications.",Change,,,,,,,"Abnormally High Number of Endpoint Changes By User",,,," `tstats` count from datamodel=Endpoint.Filesystem where Filesystem.tag=""change"" by Filesystem.user | eval change_type=""filesystem"",user='Filesystem.user' | `tstats` append=T count from datamodel=Endpoint.Registry where Registry.tag=""change"" by Registry.user | eval change_type=if(isnull(change_type),""registry"",change_type),user=if(isnull(user),'Registry.user',user) | `tstats` append=T count from datamodel=Change.All_Changes where nodename=""All_Changes.Endpoint_Changes"" by All_Changes.change_type,All_Changes.user | eval change_type=if(isnull(change_type),'All_Changes.change_type',change_type),user=if(isnull(user),'All_Changes.user',user) | stats count as change_count by change_type,user  | `mltk_apply_upper(""app:change_count_by_user_by_change_type_1d"", ""extreme"", ""change_count"")`"
ES,"DA-ESS-NetworkProtection","Abnormally High Number of HTTP Method Events By Src","Alerts when a host has an abnormally high number of HTTP requests by http method.",Web,,network,,,,,"Abnormally High Number of HTTP Method Events By Src",,,," tstats `summariesonly` count as web_event_count from datamodel=Web.Web by Web.src, Web.http_method | `drop_dm_object_name(""Web"")` | `mltk_apply_upper(""app:count_by_http_method_by_src_1d"", ""extreme"", ""web_event_count"")`"
ES,"SA-AccessProtection","Account Deleted","Detects user and computer account deletion",Change,,access,,,,,"Account Deleted",,,," from datamodel:""Change"".""Account_Management"" | where 'tag'=""delete"" | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",values(result) as ""signature"",values(src) as ""src"",values(dest) as ""dest"",count by ""src_user"",""user"" | where 'count'>0"
ES,"SA-IdentityManagement","Activity from Expired User Identity","Alerts when an event is discovered from a user associated with identity that is now expired (that is, the end date of the identity has been passed).","Identity_Management",,identity,,,,,"Activity from Expired User Identity",,,," from datamodel:""Identity_Management"".""Expired_Identity_Activity"" | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",count by ""expired_user"" | rename ""expired_user"" as ""user"""
ES,"SA-AuditAndDataProtection","Anomalous Audit Trail Activity Detected","Discovers anomalous activity such as the deletion of or clearing of log files. Attackers oftentimes clear the log files in order to hide their actions, therefore, this may indicate that the system has been compromised.",Change,,audit,,,,,"Anomalous Audit Trail Activity Detected",,,," from datamodel:""Change"".""Auditing_Changes"" | where ('action'=""cleared"" OR 'action'=""stopped"") | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",count by ""dest"",""result"" | rename ""result"" as ""signature"""
ES,"DA-ESS-EndpointProtection","Anomalous New Listening Port","Alerts a series of hosts begin listening on a new port within 24 hours. This may be an indication that the devices have been compromised or have had new (and potentially vulnerable) software installed.",,,endpoint,,,,,"Anomalous New Listening Port",,,," from inputlookup:""listeningports_tracker"" | eval earliestQual=case(match(""-24h@h"", ""^\d""), tostring(""-24h@h""),  match(""-24h@h"", ""^([@\+-]){1}""), relative_time(time(), ""-24h@h""),  true(), time()) | eval latestQual=case(match(""+0s"", ""^\d""), tostring(""+0s""),  match(""+0s"", ""^([@\+-]){1}""), relative_time(time(), ""+0s""),  true(), time()) | where ('firstTime'>=earliestQual AND 'firstTime'<=latestQual) | fields - earliestQual, latestQual | stats dc(dest) as ""dest_count"" by ""transport"",""dest_port"" | where 'dest_count'>10"
ES,"SA-EndpointProtection","Anomalous New Process","Alerts when an anomalous number hosts are detected with a new process.",,,endpoint,,,,,"Anomalous New Process",,,," from inputlookup:""localprocesses_tracker"" | eval earliestQual=case(match(""-24h@h"", ""^\d""), tostring(""-24h@h""),  match(""-24h@h"", ""^([@\+-]){1}""), relative_time(time(), ""-24h@h""),  true(), time()) | eval latestQual=case(match(""+0s"", ""^\d""), tostring(""+0s""),  match(""+0s"", ""^([@\+-]){1}""), relative_time(time(), ""+0s""),  true(), time()) | where ('firstTime'>=earliestQual AND 'firstTime'<=latestQual) | fields - earliestQual, latestQual | stats dc(dest) as ""dest_count"",values(dest) as ""dest"" by ""process"" | where 'dest_count'>9"
ES,"SA-EndpointProtection","Anomalous New Service","Alerts when an anomalous number hosts are detected with a new service.",,,endpoint,,,,,"Anomalous New Service",,,," from inputlookup:""services_tracker"" | eval earliestQual=case(match(""-24h@h"", ""^\d""), tostring(""-24h@h""),  match(""-24h@h"", ""^([@\+-]){1}""), relative_time(time(), ""-24h@h""),  true(), time()) | eval latestQual=case(match(""+0s"", ""^\d""), tostring(""+0s""),  match(""+0s"", ""^([@\+-]){1}""), relative_time(time(), ""+0s""),  true(), time()) | where ('firstTime'>=earliestQual AND 'firstTime'<=latestQual) | fields - earliestQual, latestQual | stats dc(dest) as ""dest_count"",values(dest) as ""dest"" by ""service"" | where 'dest_count'>9"
ES,"SA-IdentityManagement","Asset Ownership Unspecified","Alerts when there are assets that define a specific priority and category but do not have an assigned owner.","Identity_Management",,identity,,,,,"Asset Ownership Unspecified",,,," from datamodel:""Identity_Management"".""All_Assets"" | where isnotnull('priority') AND len('priority')>0 AND isnotnull('category') AND len('category')>0 AND (isnull('owner') OR len('owner')==0) AND (isnull('ip') OR len('ip')==0 OR mvcount('ip')==1) | stats count | where 'count'>0 | eval const_dedup_id=""const_dedup_id"""
ES,"SA-AccessProtection","Brute Force Access Behavior Detected","Detects excessive number of failed login attempts along with a successful attempt (this could indicate a successful brute force attack)",Authentication,,access,,,,,"Brute Force Access Behavior Detected",,,," from datamodel:""Authentication"".""Authentication"" | stats values(tag) as tag,values(app) as app,count(eval('action'==""failure"")) as failure,count(eval('action'==""success"")) as success by src | search success>0 | `mltk_apply_upper(""app:failures_by_src_count_1h"", ""high"", ""failure"")`"
ES,"SA-AccessProtection","Brute Force Access Behavior Detected Over One Day","Detects an excessive number of failed login attempts, along with a successful attempt, over a one day period (this could indicate a successful brute force attack)",Authentication,,access,,,,,"Brute Force Access Behavior Detected Over One Day",,,," tstats `summariesonly` values(Authentication.app) as app,count from datamodel=Authentication.Authentication by Authentication.action,Authentication.src | `drop_dm_object_name(""Authentication"")` | eval success=if(action=""success"",count,0),failure=if(action=""failure"",count,0) | stats values(app) as app,sum(failure) as failure,sum(success) as success by src | where success > 0 | `mltk_apply_upper(""app:failures_by_src_count_1d"", ""medium"", ""failure"")`"
ES,"SA-AccessProtection","Cleartext Password At Rest Detected","Detects cleartext passwords being stored at rest (such as in the Unix passwd file)","Compute_Inventory",,access,,,,,"Cleartext Password At Rest Detected",,,," from datamodel:""Compute_Inventory"".""Cleartext_Passwords"" | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",values(tag) as ""tag"",count by ""dest"",""user"",""password"""
ES,"SA-AccessProtection","Completely Inactive Account","Discovers accounts that are no longer used. Unused accounts should be disabled and are oftentimes used by attackers to gain unauthorized access.",,,access,,,,,"Completely Inactive Account",,,," from inputlookup:access_tracker | stats min(firstTime) as firstTime,max(lastTime) as lastTime by user | where ((now()-'lastTime')/86400)>90"
ES,"DA-ESS-AccessProtection","Concurrent Login Attempts Detected","Alerts on concurrent access attempts to an app from different hosts. These are good indicators of shared passwords and potential misuse.",Authentication,,access,,,,,"Concurrent Login Attempts Detected",,,," tstats `summariesonly` count from datamodel=Authentication.Authentication by _time,Authentication.app,Authentication.src,Authentication.user span=1s | `drop_dm_object_name(""Authentication"")` | eventstats dc(src) as src_count by app,user | search src_count>1 | sort 0 + _time | streamstats current=t window=2 earliest(_time) as previous_time,earliest(src) as previous_src by app,user | where (src!=previous_src) | eval time_diff=abs(_time-previous_time) | where time_diff<300"
ES,"SA-AccessProtection","Default Account Activity Detected","Discovers use of default accounts (such as admin, administrator, etc.). Default accounts have default passwords and are therefore commonly targeted by attackers using brute force attack tools.",Authentication,,access,,,,,"Default Account Activity Detected",,,," from datamodel:""Authentication"".""Successful_Default_Authentication"" | stats max(_time) as ""lastTime"",values(tag) as ""tag"",count by ""dest"",""user"",""app"""
ES,"SA-AccessProtection","Default Account At Rest Detected","Discovers the presence of default accounts even if they are not being used. Default accounts should be disabled in order to prevent an attacker from using them to gain unauthorized access to remote hosts.","Compute_Inventory",,access,,,,,"Default Account At Rest Detected",,,," from datamodel:""Compute_Inventory"".""Default_Accounts"" | where NOT match('enabled', ""0|[Ff]|[Ff][Aa][Ll][Ss][Ee]"") AND NOT 'status'==""Degraded"" AND NOT like('shell',""%nologin"") AND NOT like('shell',""%false"") AND 'user'!=""root"" | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",values(tag) as ""tag"",count by ""dest"",""user"""
ES,"DA-ESS-NetworkProtection","Excessive DNS Failures","Alerts when a host receives many DNS failures in a short span","Network_Resolution",,network,,,,,"Excessive DNS Failures",,,," tstats summariesonly=true count from datamodel=""Network_Resolution"".""DNS"" where ""DNS.reply_code""!=""No error"" AND ""DNS.reply_code""!=""NoError"" by ""DNS.src""  | rename ""DNS.src"" as ""src"" | where 'count'>100"
ES,"DA-ESS-NetworkProtection","Excessive DNS Queries","Alerts when a host starts sending excessive DNS queries","Network_Resolution",,network,,,,,"Excessive DNS Queries",,,," tstats summariesonly=true count from datamodel=""Network_Resolution"".""DNS"" where    ""DNS.message_type""=""QUERY"" by ""DNS.src"" | rename ""DNS.src"" as ""src"" | where 'count'>100"
ES,"SA-AccessProtection","Excessive Failed Logins","Detects excessive number of failed login attempts (this is likely a brute force attack)",Authentication,,access,,,,,"Excessive Failed Logins",,,," from datamodel:""Authentication"".""Failed_Authentication"" | stats values(tag) as ""tag"",dc(user) as ""user_count"",dc(dest) as ""dest_count"",count by ""app"",""src"" | where 'count'>=6"
ES,"DA-ESS-NetworkProtection","Excessive HTTP Failure Responses","Alerts when a host generates a lot of HTTP failures in a short span of time",Web,,network,,,,,"Excessive HTTP Failure Responses",,,," tstats summariesonly=true count from datamodel=""Web"".""Web"" where    (""Web.status""=400 OR ""Web.status""=403 OR ""Web.status""=404 OR ""Web.status""=411 OR ""Web.status""=500 OR ""Web.status""=501) by ""Web.dest"" | rename ""Web.dest"" as ""dest"" | where 'count'>50"
ES,"SA-AuditAndDataProtection","Expected Host Not Reporting","Discovers hosts that are longer reporting events but should be submitting log events. This rule is used to monitor hosts that you know should be providing a constant stream of logs in order to determine why the host has failed to provide log data.",,,audit,,,,,"Expected Host Not Reporting",,,," `host_eventcount(30,2)` | search is_expected=true | `ctime(lastTime)` | fields + host,lastTime,is_expected,tag,dayDiff"
ES,"DA-ESS-AccessProtection","Geographically Improbable Access Detected","Alerts on access attempts that are improbable based on time and geography.",,,access,,,,,"Geographically Improbable Access Detected",,,,"search index=gia_summary source=""Access - Geographically Improbable Access - Summary Gen"" | fields user,src_time,src_app,src,src_lat,src_long,src_city,src_country,dest_time,dest_app,dest,dest_lat,dest_long,dest_city,dest_country,distance,speed"
ES,"DA-ESS-EndpointProtection","High Number Of Infected Hosts","Alerts when a high total number of infected hosts is discovered.",Malware,,endpoint,,,,,"High Number Of Infected Hosts",,,," tstats summariesonly=true estdc(Malware_Attacks.dest) as ""infected_hosts"" from datamodel=""Malware"".""Malware_Attacks""    | where 'infected_hosts'>100 | eval const_dedup_id=""const_dedup_id"""
ES,"DA-ESS-EndpointProtection","High Number of Hosts Not Updating Malware Signatures","Alerts when a high number of hosts not updating malware signatures have been discovered.  These hosts should be evaluated to determine why they are not updating their malware signatures.",,,endpoint,,,,,"High Number of Hosts Not Updating Malware Signatures",,,," `malware_operations_tracker` | rename time_signature_version as _time | `dayDiff(_time)` | search dayDiff>7 | stats count | search count>10 | eval const_dedup_id=""Endpoint - High Number of Hosts Not Updating Malware Signatures - Rule"""
ES,"DA-ESS-EndpointProtection","High Or Critical Priority Host With Malware Detected","Alerts when an infection is noted on a host with high or critical priority.",Malware,,endpoint,,,,,"High Or Critical Priority Host With Malware Detected",,,," from datamodel:""Malware"".""Malware_Attacks"" | where ('dest_priority'=""high"" OR 'dest_priority'=""critical"") | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",values(dest_priority) as ""dest_priority"",count by ""dest"",""signature"""
ES,"DA-ESS-EndpointProtection","High Process Count","Alerts when host has a high number of processes. This may be due to an infection or a runaway process.",Endpoint,,endpoint,,,,,"High Process Count",,,," tstats `summariesonly` max(_time) as _time from datamodel=Endpoint.Processes by Processes.dest,Processes.process | `drop_dm_object_name(""Processes"")` | eventstats max(_time) as lastReportTime by dest | where _time==lastReportTime | stats dc(process) as process_count by dest | search process_count>200"
ES,"DA-ESS-IdentityManagement","High Volume Email Activity to Non-corporate Domains by User","Alerts on high volume email activity by a user to non-corporate domains.",Email,,identity,,,,,"High Volume Email Activity to Non-corporate Domains by User",,,," tstats `summariesonly` sum(All_Email.size) as bytes, values(All_Email.recipient) as recipient from datamodel=Email.All_Email where NOT `cim_corporate_email_domain_search(""All_Email.recipient"")` by All_Email.src_user, All_Email.src_user_bunit | `drop_dm_object_name(""All_Email"")` | `mltk_apply_upper(""app:email_activity_to_non_corporate_by_user_1h"", ""medium"", ""bytes"")`"
ES,"DA-ESS-NetworkProtection","High Volume of Web Activity from Critical System","Alerts when a system of high or critical severity generates a high volume of outbound web activity. This may indicate that the system has been compromised.",Web,,network,,,,,"High Volume of Web Activity from Critical System",,,," tstats summariesonly=true sum(Web.bytes_out) as ""bytes_out"" from datamodel=""Web"".""Web"" where    ""Web.bytes_out"">0 AND (""Web.src_priority""=""high"" OR ""Web.src_priority""=""critical"") by ""Web.src"",""Web.dest"" | rename ""Web.src"" as ""src"",""Web.dest"" as ""dest"" | where 'bytes_out'>10485760"
ES,"DA-ESS-AccessProtection","High or Critical Priority Individual Logging into Infected Machine","Detects users with a high or critical priority logging into a malware infected machine",Malware,,access,,,,,"High or Critical Priority Individual Logging into Infected Machine",,,," tstats `summariesonly` values(Authentication.user) as ""user"" from datamodel=Authentication.Authentication where earliest=-70m@m latest=+0s nodename=Authentication.Successful_Authentication (""Authentication.user_priority""=""high"" OR ""Authentication.user_priority""=""critical"") by ""Authentication.dest"" | rename ""Authentication.dest"" as ""dest"" | eval cs_key='dest' | join type=inner cs_key [| tstats summariesonly=false values(Malware_Attacks.signature) as ""signature"" from datamodel=Malware.Malware_Attacks where earliest=-1450m@m latest=+0s nodename=Malware_Attacks.Allowed_Malware  by ""Malware_Attacks.dest"" | rename ""Malware_Attacks.dest"" as ""dest"" | eval cs_key='dest']"
ES,"DA-ESS-EndpointProtection","Host Sending Excessive Email","Alerts when an host not designated as an e-mail server sends excessive e-mail to one or more target hosts.",Email,,endpoint,,,,,"Host Sending Excessive Email",,,," tstats `summariesonly` sum(All_Email.recipient_count) as recipient_count,dc(All_Email.dest) as dest_count from datamodel=Email.All_Email where NOT All_Email.src_category=""email_servers"" by ""All_Email.src"",_time span=1h | `drop_dm_object_name(""All_Email"")` | apply app:recipients_by_src_1h [|`get_qualitative_upper_threshold(high)`] | apply app:destinations_by_src_1h [|`get_qualitative_upper_threshold(high)`] | search ""IsOutlier(recipient_count)""=1 OR ""IsOutlier(dest_count)""=1"
ES,"SA-EndpointProtection","Host With A Recurring Malware Infection","Alerts when a host has an infection that has been re-infected remove multiple times over multiple days.",Malware,,endpoint,,,,,"Host With A Recurring Malware Infection",,,," tstats summariesonly=true dc(Malware_Attacks.date) as ""day_count"",count from datamodel=""Malware"".""Malware_Attacks""   by ""Malware_Attacks.dest"",""Malware_Attacks.signature"" | rename ""Malware_Attacks.dest"" as ""dest"",""Malware_Attacks.signature"" as ""signature"" | where 'day_count'>3"
ES,"DA-ESS-EndpointProtection","Host With High Number Of Listening ports","Alerts when host has a high number of listening services. This may be an indication that the device is running services that are not necessary (such as a default installation of a server) or is not running a firewall.",Endpoint,,endpoint,,,,,"Host With High Number Of Listening ports",,,," tstats summariesonly=true dc(Ports.transport_dest_port) as ""port_count"" from datamodel=""Endpoint"".""Ports""  by ""Ports.dest"" | rename ""Ports.dest"" as ""dest"" | where 'port_count'>20"
ES,"DA-ESS-EndpointProtection","Host With High Number Of Services","Alerts when host has a high number of services. This may be an indication that the device is running services that are not necessary (such as a default installation of a server).",Endpoint,,endpoint,,,,,"Host With High Number Of Services",,,," tstats summariesonly=true dc(Services.service) as ""service_count"" from datamodel=""Endpoint"".""Services""  by ""Services.dest"" | rename ""Services.dest"" as ""dest"" | where 'service_count'>100"
ES,"DA-ESS-EndpointProtection","Host With Multiple Infections","Alerts when a host with multiple infections is discovered.",Malware,,endpoint,,,,,"Host With Multiple Infections",,,," tstats summariesonly=true dc(Malware_Attacks.signature) as ""infection_count"" from datamodel=""Malware"".""Malware_Attacks""   by ""Malware_Attacks.dest"" | rename ""Malware_Attacks.dest"" as ""dest"" | where 'infection_count'>1"
ES,"DA-ESS-EndpointProtection","Host With Old Infection Or Potential Re-Infection","Alerts when a host with an old infection is discovered (likely a re-infection).",Malware,,endpoint,,,,,"Host With Old Infection Or Potential Re-Infection",,,," tstats `summariesonly` max(_time) as lastTime from datamodel=Malware.Malware_Attacks by Malware_Attacks.signature,Malware_Attacks.dest | `drop_dm_object_name(""Malware_Attacks"")` | lookup local=true malware_tracker dest,signature OUTPUT firstTime | eval dayDiff=round((lastTime-firstTime)/86400,1) | search dayDiff>30"
ES,"SA-AccessProtection","Inactive Account Activity Detected","Discovers previously inactive accounts that are now being used. This may be due to an attacker that successfully gained access to an account that was no longer being used.",,,access,,,,,"Inactive Account Activity Detected",,,," `inactive_account_usage(""90"",""2"")` | `ctime(lastTime)` | fields + user,tag,inactiveDays,lastTime"
ES,"SA-AccessProtection","Insecure Or Cleartext Authentication Detected","Detects authentication requests that transmit the password over the network as cleartext (unencrypted)",Authentication,,access,,,,,"Insecure Or Cleartext Authentication Detected",,,," from datamodel:""Authentication"".""Insecure_Authentication"" | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",values(tag) as ""tag"",count by ""app"",""dest"""
ES,"SA-EndpointProtection","Multiple Primary Functions Detected","Multiple Primary Functions Detected",,,endpoint,,,,,"Multiple Primary Functions Detected",,,," `primary_functions_tracker` | eval _time=lastTime | `hoursago(24)` | search is_primary=true | stats values(function) as function,dc(function) as function_count by dest | search function_count>1"
ES,"SA-NetworkProtection","Network Change Detected","Detects changes to policies of the network protection devices (such as firewall policy changes).",Change,,network,,,,,"Network Change Detected",,,," from datamodel:""Change"".""Network_Changes"" | stats max(_time) as ""lastTime"",latest(_raw) as ""orig_raw"",count by ""dvc"",""action"",""command"""
ES,"SA-NetworkProtection","Network Device Rebooted","Increases the risk score of network devices that have been rebooted.",Change,,,,,,,"Network Device Rebooted",,,," tstats summariesonly=true count from datamodel=""Change"".""All_Changes"" where nodename=""All_Changes.Network_Changes.Device_Restarts"" by ""All_Changes.dvc"",""_time"" span=""1s"" | rename ""All_Changes.dvc"" as ""dvc"""
ES,"DA-ESS-EndpointProtection","New User Account Created On Multiple Hosts","Alerts when a previously unseen account is created on multiple hosts.",,,endpoint,,,,,"New User Account Created On Multiple Hosts",,,," from inputlookup:""useraccounts_tracker"" | eval earliestQual=case(match(""-24h@h"", ""^\d""), tostring(""-24h@h""),  match(""-24h@h"", ""^([@\+-]){1}""), relative_time(time(), ""-24h@h""),  true(), time()) | eval latestQual=case(match(""+0s"", ""^\d""), tostring(""+0s""),  match(""+0s"", ""^([@\+-]){1}""), relative_time(time(), ""+0s""),  true(), time()) | where ('firstTime'>=earliestQual AND 'firstTime'<=latestQual) | fields - earliestQual, latestQual | stats dc(dest) as ""dest_count"" by ""user"" | where 'dest_count'>3"
ES,"SA-EndpointProtection","Outbreak Detected","Alerts when a potential outbreak is observed based on newly infected systems all exhibiting the same infection",Malware,,endpoint,,,,,"Outbreak Detected",,,," tstats summariesonly=true dc(Malware_Attacks.dest) as ""system_count"",values(Malware_Attacks.tag) as ""tag"" from datamodel=""Malware"".""Malware_Attacks""   by ""Malware_Attacks.signature""  | rename ""Malware_Attacks.signature"" as ""signature"" | where 'system_count'>10"
ES,"SA-AuditAndDataProtection","Personally Identifiable Information Detected","Detects personally identifiable information (PII) in log files. Some software will inadvertently provide sensitive information in log files and thus causing the information to be exposed unnecessarily to those reviewing the log files.",,,audit,,,,,"Personally Identifiable Information Detected",,,,"search NOT sourcetype=stash | `get_integer_seq` | lookup luhn_lite_lookup integer_seq OUTPUTNEW pii,pii_clean | eval pii_length=len(pii_clean) | lookup iin_lookup iin as pii_clean,length as pii_length OUTPUTNEW iin_issuer | search iin_issuer=* | `get_event_id` | fields + event_id,_raw,host,pii,iin_issuer | eval pii_hash=sha1(pii)"
ES,"SA-AuditAndDataProtection","Potential Gap in Data","Detects gaps caused by the failure of the search head. If saved searches do not execute then there may be gaps in summary data.","Splunk_Audit",,audit,,,,,"Potential Gap in Data",,,," from datamodel:""Splunk_Audit"".""Scheduler_Activity"" | where 'status'=""success"" AND ('app' LIKE ""Splunk_%"" OR 'app' LIKE ""SA-%"" OR 'app' LIKE ""DA-%"" OR 'app'=""SplunkEnterpriseSecuritySuite"" OR 'app'=""SplunkPCIComplianceSuite"") | stats count | where 'count'=0 | eval const_dedup_id=""const_dedup_id"""
ES,"DA-ESS-NetworkProtection","Prohibited Port Activity Detected","Detects the use of ports that are prohibited. Useful for detecting the installation of new software or a successful compromise of a host (such as the presence of a backdoor or a system communicating with a botnet).","Network_Traffic",,network,,,,,"Prohibited Port Activity Detected",,,," from datamodel:""Network_Traffic"".""Allowed_Traffic"" | `is_traffic_prohibited(dest_port)` | search dest_port>0 NOT is_prohibited=false | stats count by dvc,transport,dest_port,is_prohibited | `get_asset(dvc)` | `get_identity4events(dvc_owner)`"
ES,"SA-EndpointProtection","Prohibited Process Detected","Alerts when a service in the prohibited process list is detected.",Endpoint,,endpoint,,,,,"Prohibited Process Detected",,,," from datamodel:""Endpoint"".""Processes"" | `get_interesting_processes` | search is_prohibited=true | `get_event_id` | fields + event_id,_raw,dest,process,note"
ES,"SA-EndpointProtection","Prohibited Service Detected","Alerts when a service in the prohibited service list is detected.",,,endpoint,,,,,"Prohibited Service Detected",,,,"search NOT sourcetype=stash `service` | `get_interesting_services` | search is_prohibited=true | `get_event_id` | fields + event_id,_raw,dest,service,note"
ES,"SA-ThreatIntelligence","Same Error On Many Servers Detected","Alerts when multiple systems are exhibiting the same errors",,,threat,,,,,"Same Error On Many Servers Detected",,,,"search tag=error NOT tag=authentication | stats first(_raw) as orig_raw,dc(host) as system_count by sourcetype,punct | where 'system_count'>100"
ES,"DA-ESS-AccessProtection","Short-lived Account Detected","Detects when a account or credential is created and then removed a short time later. This may be an indication of malicious activities.",Change,,access,,,,,"Short-lived Account Detected",,,," tstats `summariesonly` count from datamodel=Change.All_Changes where nodename=""All_Changes.Account_Management"" (All_Changes.action=""created"" OR All_Changes.action=""deleted"") by _time,All_Changes.dest,All_Changes.user span=1s | `drop_dm_object_name(""All_Changes"")` | streamstats range(_time) as delta,sum(count) as count by user,dest window=2 global=f | where count>1 AND delta<`useraccount_minimal_lifetime` | `uptime2string(delta,timestr)` | table user, dest, delta, timestr"
ES,"SA-EndpointProtection","Should Timesync Host Not Syncing","Detects when hosts that are required to synchronize their clocks have failed to do so. Time synchronization is important because it ensures that the event logs are stamped with the proper time. Additionally, this is required by some regulatory compliance standards (such as PCI).",Performance,,endpoint,,,,,"Should Timesync Host Not Syncing",,,," tstats `summariesonly` max(_time) as lastTime from datamodel=Performance.All_Performance where nodename=All_Performance.OS.Timesync All_Performance.OS.Timesync.action=success by All_Performance.dest | rename All_Performance.dest as dest | `get_asset(dest)` | rename dest_* as * | `assets` | search should_timesync=true | stats max(lastTime) as lastTime,first(should_timesync) as should_timesync,values(asset) as dest by asset_id | where isnull(lastTime) | addinfo | eval hourDiff=floor((info_max_time-info_min_time)/3600) | fields dest,should_timesync,hourDiff"
ES,"SA-NetworkProtection","Substantial Increase In Intrusion Events","Alerts when a statistically significant increase in a particular intrusion event is observed.","Intrusion_Detection",,network,,,,,"Substantial Increase In Intrusion Events",,,," tstats `summariesonly` count as ids_attacks,values(IDS_Attacks.tag) as tag from datamodel=Intrusion_Detection.IDS_Attacks by IDS_Attacks.signature | `drop_dm_object_name(""IDS_Attacks"")` | `mltk_apply_upper(""app:count_by_signature_1h"", ""high"", ""ids_attacks"")`"
ES,"SA-NetworkProtection","Substantial Increase In Port Activity","Alerts when a statistically significant increase in events on a given port is observed.","Network_Traffic",,network,,,,,"Substantial Increase In Port Activity",,,," tstats `summariesonly` count as dest_port_traffic_count,values(All_Traffic.tag) as tag from datamodel=Network_Traffic.All_Traffic by All_Traffic.dest_port | `drop_dm_object_name(""All_Traffic"")` | `mltk_apply_upper(""app:count_by_dest_port_1d"", ""extreme"", ""dest_port_traffic_count"")`"
ES,"DA-ESS-ThreatIntelligence","Threat Activity Detected","Alerts when any activity matching threat intelligence is detected.","Threat_Intelligence",,threat,,,,,"Threat Activity Detected",,,," from datamodel:""Threat_Intelligence"".""Threat_Activity"" | dedup threat_match_field,threat_match_value | `get_event_id` | table _raw,event_id,source,src,dest,threat*,weight | rename weight as record_weight | `per_panel_filter(""ppf_threat_activity"",""threat_match_field,threat_match_value"")` | `get_threat_attribution(threat_key)` | rename source_* as threat_source_*,description as threat_description | eval risk_score=case(isnum(record_weight), record_weight, isnum(weight), weight, 1=1, null())  | fields - *time | eval risk_object_type=case(threat_match_field=""query"" OR threat_match_field==""src"" OR threat_match_field==""dest"",""system"",threat_match_field==""src_user"" OR threat_match_field==""user"",""user"",1=1,""other"") | eval risk_object=threat_match_value"
ES,"DA-ESS-NetworkProtection","Unroutable Activity Detected","Alerts when activity to or from a host that is unroutable is detected.",Web,,network,,,,,"Unroutable Activity Detected",,,," `tstats` count,values(sourcetype) from datamodel=Network_Traffic.All_Traffic where All_Traffic.action=""allowed"" AND `bogonlist_src_dest_subsearch(All_Traffic)` by All_Traffic.src,All_Traffic.dest | `drop_dm_object_name(""All_Traffic"")` | `tstats` append=true count,values(sourcetype) from datamodel=Intrusion_Detection.IDS_Attacks where `bogonlist_src_dest_subsearch(IDS_Attacks)` by IDS_Attacks.src,IDS_Attacks.dest | `drop_dm_object_name(""IDS_Attacks"")` | `tstats` append=true count,values(sourcetype) from datamodel=Web.Web where `bogonlist_src_dest_subsearch(Web)` by Web.src,Web.dest | `drop_dm_object_name(""Web"")` | stats count,values(sourcetype) as sourcetype by src,dest | `bogonlist_lookup` | eval bogon_ip=if(dest_is_bogon==""true"" AND dest_is_internal!=""true"",dest,src) | fields + sourcetype,src,dest,bogon_ip"
ES,"SA-ThreatIntelligence","Untriaged Notable Events","Alerts when notable events have not been triaged",,,,,,,,"Untriaged Notable Events",,,,"search `notable` | search (status_group=""New"" OR owner=""unassigned"") | stats count by rule_name | eventstats sum(count) as total"
ES,"DA-ESS-NetworkProtection","Unusual Volume of Network Activity","Detects unusual network traffic that may be indicative of a DoS attack as indicated by a high number of unique sources or a high volume of firewall packets","Network_Traffic",,network,,,,,"Unusual Volume of Network Activity",,,," tstats `summariesonly` dc(All_Traffic.src) as src_count,count as total_count from datamodel=Network_Traffic.All_Traffic | apply app:network_traffic_src_count_30m [|`get_qualitative_upper_threshold(extreme)`] | apply app:network_traffic_count_30m [|`get_qualitative_upper_threshold(extreme)`] | search ""IsOutlier(src_count)""=1 OR ""IsOutlier(total_count)""=1"
ES,"SA-NetworkProtection","Vulnerability Scanner Detected (by events)","Detects a potential vulnerability scanner by detecting devices that have triggered a large number of unique events. Vulnerability scanners generally trigger a high number unique events when scanning a host since each vulnerability check tends to trigger a unique event.","Intrusion_Detection",,network,,,,,"Vulnerability Scanner Detected (by events)",,,," from datamodel:""Intrusion_Detection"".""IDS_Attacks"" | stats values(tag) as ""tag"",dc(signature) as ""count"" by ""src"" | where 'count'>25"
ES,"SA-NetworkProtection","Vulnerability Scanner Detected (by targets)","Detects a potential vulnerability scanner by detecting devices that have triggered events against a large number of unique targets. Vulnerability scanners generally trigger events against a high number of unique hosts when they are scanning a network for vulnerable hosts.","Intrusion_Detection",,network,,,,,"Vulnerability Scanner Detected (by targets)",,,," from datamodel:""Intrusion_Detection"".""IDS_Attacks"" | stats values(tag) as ""tag"",dc(dest) as ""count"" by ""src"" | where 'count'>25"
ES,"SA-ThreatIntelligence","Watchlisted Event Observed","Alerts when an event is discovered including text has been identified as important. This rule triggers whenever an event is discovered with the tag of ""watchlist"".",,,threat,,,,,"Watchlisted Event Observed",,,,"search tag=watchlist NOT sourcetype=stash | eval risk_object=case(isnotnull(user),user,isnotnull(src_user),src_user,isnotnull(dest),dest,isnotnull(src),src,1=1,host) | eval risk_object_type=case(isnotnull(user),""user"",isnotnull(src_user),""user"",isnotnull(dest),""system"",isnotnull(src),""system"",1=1,""system"") | eval risk_score=if(eventtype=""website_watchlist"",50,null()) | eval suppression_value=sourcetype.""|"".risk_object  | `get_event_id` | table _raw,event_id,host,source,sourcetype,src,dest,dvc,src_user,user"
ES,"DA-ESS-IdentityManagement","Web Uploads to Non-corporate Sites by Users","Alerts on high volume web uploads by a user to non-corporate domains.",Web,,identity,,,,,"Web Uploads to Non-corporate Sites by Users",,,," tstats `summariesonly` sum(Web.bytes) as bytes from datamodel=Web.Web where (Web.http_method=""POST"" OR Web.http_method=""PUT"")  NOT (`cim_corporate_web_domain_search(""Web.url"")`) by Web.user, Web.user_bunit | `drop_dm_object_name(""Web"")` | `mltk_apply_upper(""app:web_upload_to_non_corporate_by_user_1h"", ""medium"", ""bytes"")`"
